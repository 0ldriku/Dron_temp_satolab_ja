% **************************************************************************************************************
% A Classic Thesis Style (Modified Version)
% An Homage to The Elements of Typographic Style
%
% Original Copyright (C) 2025 André Miede and Ivo Pletikosić
%
% This is a modified version with enhancements for:
% - APA 7th edition citation style
% - Enhanced Japanese/CJK language support via XeLaTeX
% - Custom Japanese author name formatting
% - Japanese reference sorting capabilities
%
% Modifications are shared under the same GPL license as the original work.
%
% Original template: https://ctan.org/pkg/classicthesis
% If you like the original style, the authors appreciate postcards at:
% http://postcards.miede.de
%
% License:
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; either version 2 of the License, or
% (at your option) any later version.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; see the file COPYING.  If not, write to
% the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
% Boston, MA 02111-1307, USA.
%
% PLEASE SEE ALSO THE AUTHORS' NOTE REGARDING THIS LICENSE
% IN THE DOCUMENTATION (Chapter 3 / Chapter03.tex - License and Attribution section)
% **************************************************************************************************************
\RequirePackage{silence} % :-\
    \WarningFilter{scrreprt}{Usage of package `titlesec'}
    %\WarningFilter{scrreprt}{Activating an ugly workaround}
    \WarningFilter{titlesec}{Non standard sectioning command detected}
\documentclass[ twoside,openright,titlepage,numbers=noenddot,%1headlines,
                headinclude,footinclude,cleardoublepage=empty,abstract=on,
                BCOR=5mm,paper=a4,fontsize=11pt
                ]{scrbook}

%********************************************************************
% Note: Make all your adjustments in here
%*******************************************************
\input{classicthesis-config}
\setlength{\emergencystretch}{3em}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{threeparttable}
\usepackage{siunitx}
\usepackage{rotating}
\usepackage{xurl}
\usepackage{tcolorbox}
\usepackage{multicol}
\usepackage{colortbl}       
\usepackage{array}         
\usepackage{amsthm}

\definecolor{headerblue}{RGB}{52, 73, 94}
\definecolor{lightgray}{RGB}{245, 245, 245}

\usepackage{xeCJK}
  \setmainfont[
    Ligatures=TeX,
    UprightFont=* Regular,
    BoldFont=* Bold,
    ItalicFont=* Italic,
    BoldItalicFont=* Bold Italic
  ]{Noto Serif}
  \setsansfont[
    BoldFont=* Bold,
    ItalicFont=* Italic,
    BoldItalicFont=* Bold Italic
  ]{Noto Sans}
  %\setmonofont[
  %  BoldFont=* Bold
  %]{Noto Sans Mono}
  \setCJKmainfont[
    %Scale=MatchLowercase,
    SmallCapsFont = Noto Sans CJK JP,  % Japanese in \section (SmallCaps) -> Gothic
    ItalicFont = Noto Sans CJK JP,      % Japanese in \subsection (Italic) -> Gothic
    BoldFont=Noto Serif CJK JP Bold
]{Noto Serif CJK JP}
  \setCJKsansfont[
    %Scale=MatchLowercase,
    BoldFont=Noto Sans CJK JP Bold
]{Noto Sans CJK JP}
  \setCJKmonofont[BoldFont=Noto Sans Mono CJK JP Bold]{Noto Sans Mono CJK JP}% Default fonts, can be customized

  % Define Medium weight font for headers
  \newfontfamily\headerLatin{Noto Sans CJK JP}[UprightFont=*-Medium]
  \newCJKfontfamily\headerCJK{Noto Sans CJK JP}[UprightFont=*-Medium]
  \newcommand{\myHeaderFont}{\headerLatin\headerCJK}

  % Define Chapter Font (Noto Sans CJK JP Medium)
  \newfontfamily\chapterLatin{Noto Serif CJK JP}[UprightFont=*-Medium]
  \newCJKfontfamily\chapterCJK{Noto Serif CJK JP}[UprightFont=*-Medium]
  \newcommand{\myChapterFont}{\chapterLatin\chapterCJK}

  % Define Scalable Chapter Number Font (Palatino)
  \newfontface\myChapterNumberFont{texgyrepagella-regular}[Extension= .otf]

  % Define Light Sans font for captions
  \newfontfamily\captionLightLatin{Noto Sans CJK JP Light}
  \newCJKfontfamily\captionLightCJK{Noto Sans CJK JP Light}
  \newcommand{\captionLightFont}{\captionLightLatin\captionLightCJK}

  % 1. Define Simplified Chinese (SC)
\newCJKfontfamily\schinesefont{Noto Serif CJK SC}[
  Script=CJK,
  Language=Chinese Simplified
]

% 2. Define Traditional Chinese (TC) - Optional if you need it
\newCJKfontfamily\tchinesefont{Noto Serif CJK TC}[
  Script=CJK,
  Language=Chinese Traditional
]

% 3. Define Korean (KR)
\newCJKfontfamily\koreanfont{Noto Serif CJK KR}[
  Script=CJK,
  Language=Korean
]

% 1. Enclosed Alphanumerics (①, ⓐ) - Noto handles these well
\xeCJKDeclareCharClass{CJK}{"2460->"24FF}

% 2. CJK Compatibility (㍻, ㎏, ㎡) - Noto handles these well
\xeCJKDeclareCharClass{CJK}{"3300->"33FF}

\xeCJKDeclareCharClass{CJK}{`☀,`☁,`☂,`☃,`★,`☆,`☎,`☏,`☜,`☝,`☞,`☟,`☯,`♀,`♁,`♂,`☉}


\newcommand{\textzhtc}[1]{{\tchinesefont #1}} % for Traditional Chinese
\newcommand{\textzh}[1]{{\schinesefont #1}} % for Simplified Chinese
\newcommand{\textko}[1]{{\koreanfont #1}}   % for Korean


%********************************************************************
% Bibliographies
%*******************************************************
\addbibresource{Bibliography.bib}
\addbibresource[label=part1]{part1.bib}
\addbibresource[label=part2]{part2.bib}
% Additional bibliography files can be added here as needed

%********************************************************************
% Hyphenation
%*******************************************************
%\hyphenation{put special hyphenation here}

% ********************************************************************
% ToC Customization
% ********************************************************************
\makeatletter
\AtBeginDocument{%
    % Rename ToC
    \renewcommand{\contentsname}{目次}
    \@ifpackageloaded{babel}{%
        \addto\captionsamerican{\renewcommand{\contentsname}{目次}}%
        \addto\captionsenglish{\renewcommand{\contentsname}{目次}}%
    }{}
    
    % Define Regular weight font for ToC
    \newfontfamily\headerLatinRegular{Noto Sans CJK JP}
    \newCJKfontfamily\headerCJKRegular{Noto Sans CJK JP}
    \newcommand{\myHeaderRegularFont}{\headerLatinRegular\headerCJKRegular}

    % Part (Gothic Medium, Large, Uppercase Roman)
    \renewcommand{\thepart}{\Roman{part}}
    \renewcommand{\cftpartfont}{\color{CTtitle}\myHeaderFont\Large}
    \renewcommand{\cftpartpagefont}{\myHeaderFont\Large}
    \renewcommand{\cftpartpresnum}{\myHeaderFont\Large}
    \renewcommand{\cftpartaftersnum}{}
    \renewcommand{\cftpartaftersnumb}{}
    \setlength{\cftpartnumwidth}{2em}

    % Chapter (Serif, Large)
    \renewcommand{\cftchapfont}{\rmfamily\normalsize}
    \renewcommand{\cftchappagefont}{\rmfamily\normalsize}
    \renewcommand{\cftchappresnum}{\rmfamily\normalsize}
    \renewcommand{\cftchapaftersnumb}{}
    \setlength{\cftbeforechapskip}{0.66\baselineskip}

    % Section (Gothic Regular, Normal)
    \renewcommand{\cftsecfont}{\myHeaderRegularFont\normalsize}
    \renewcommand{\cftsecpagefont}{\myHeaderRegularFont\normalsize}
    \renewcommand{\cftsecpresnum}{\myHeaderRegularFont\normalsize}
    \setlength{\cftbeforesecskip}{0.33em}

    % Subsection (Gothic Regular, Small)
    \renewcommand{\cftsubsecfont}{\captionLightFont\small}
    \renewcommand{\cftsubsecpagefont}{\captionLightFont\small}
    \renewcommand{\cftsubsecpresnum}{\captionLightFont\small}
    \setlength{\cftbeforesubsecskip}{0.33em}
    
    % Subsubsection (Gothic Light, Small)
    \renewcommand{\cftsubsubsecfont}{\captionLightFont\small}
    \renewcommand{\cftsubsubsecpagefont}{\captionLightFont\small}
    \renewcommand{\cftsubsubsecpresnum}{\captionLightFont\small}

    % List of Figures (Label: Regular, Caption: Light)
    \renewcommand{\listfigurename}{図目次}
    \@ifpackageloaded{babel}{%
        \addto\captionsamerican{\renewcommand{\listfigurename}{図目次}}%
        \addto\captionsenglish{\renewcommand{\listfigurename}{図目次}}%
    }{}
    \renewcommand{\cftfigfont}{\captionLightFont\small}
    \renewcommand{\cftfigpagefont}{\captionLightFont\small}
    \renewcommand{\cftfigpresnum}{\myHeaderRegularFont\small 図~}
    \renewcommand{\cftfigaftersnum}{\captionLightFont\small}
    \setlength{\cftfignumwidth}{4em}
    
    % List of Tables (Label: Regular, Caption: Light)
    \renewcommand{\listtablename}{表目次}
    \@ifpackageloaded{babel}{%
        \addto\captionsamerican{\renewcommand{\listtablename}{表目次}}%
        \addto\captionsenglish{\renewcommand{\listtablename}{表目次}}%
    }{}
    \renewcommand{\cfttabfont}{\captionLightFont\small}
    \renewcommand{\cfttabpagefont}{\captionLightFont\small}
    \renewcommand{\cfttabpresnum}{\myHeaderRegularFont\small 表~}
    \renewcommand{\cfttabaftersnum}{\captionLightFont\small}
    \setlength{\cfttabnumwidth}{4em}

    % Part Cover Page Format (第I部)
    \titleformat{\part}[display]
        {\normalfont\centering\Large\rmfamily\bfseries}
        {\thispagestyle{empty} 第\thepart 部}{1em}
        {\color{CTtitle}}[\bigskip\normalfont\normalsize\color{Black}\begin{quote}\ctparttext@print\end{quote}]
}
\makeatother

% ********************************************************************
% GO!GO!GO! MOVE IT!
%*******************************************************
\begin{document}
\frenchspacing
\raggedbottom
\selectlanguage{american} % american ngerman
\renewcommand*{\bibname}{引用文献}
%\setbibpreamble{}
\pagenumbering{roman}
\pagestyle{plain}
%********************************************************************
% Frontmatter
%*******************************************************
%\include{FrontBackmatter/DirtyTitlepage}
%\include{FrontBackmatter/VersionHistory}

\include{FrontBackmatter/Titlepage}
\include{FrontBackmatter/Titleback}
\cleardoublepage\include{FrontBackmatter/Committee}
\cleardoublepage\include{FrontBackmatter/Dedication}
%\cleardoublepage\include{FrontBackmatter/Foreword}
\cleardoublepage\include{FrontBackmatter/Abstract}
\cleardoublepage\include{FrontBackmatter/Publications}
\cleardoublepage\include{FrontBackmatter/Acknowledgments}
\cleardoublepage\include{FrontBackmatter/Contents}
%********************************************************************
% Mainmatter
%*******************************************************
\cleardoublepage
\pagestyle{scrheadings}
\pagenumbering{arabic}
%\setcounter{page}{90}
% use \cleardoublepage here to avoid problems with pdfbookmark
\cleardoublepage
\ctparttext{This part provides essential information for getting started with the template, including setup instructions and basic usage guidelines.}
\part{ガイド}\label{pt:guide}
\include{Chapters/Chapter01}
\cleardoublepage

\ctparttext{This part demonstrates various \LaTeX{} features available in this template, including formatting, citations, figures, tables, and multilingual support.}
\part{使用例}\label{pt:showcase}
\include{Chapters/Chapter02}
\include{Chapters/Chapter03}
\cleardoublepage

\ctparttext{This part contains detailed documentation about template configuration, customization options, and technical specifications.}
\part{マニュアル}\label{pt:manual}
\include{Chapters/Chapter04}
\cleardoublepage
% ********************************************************************
% Backmatter
%*******************************************************
\appendix
%\renewcommand{\thechapter}{\alph{chapter}}
\cleardoublepage
\part{付録}
\include{Chapters/AppendixA}
\include{Chapters/AppendixB}
%********************************************************************
% Other Stuff in the Back
%*******************************************************
\pdfbookmark[-1]{Back Matter}{back} % Dummy part bookmark for back matter
\cleardoublepage\include{FrontBackmatter/Bibliography}
%\cleardoublepage\include{FrontBackmatter/Declaration}
\cleardoublepage\include{FrontBackmatter/Colophon}
% ********************************************************************
% Game Over: Restore, Restart, or Quit?
%*******************************************************
\end{document}
% ********************************************************************
% ********************************************************************
